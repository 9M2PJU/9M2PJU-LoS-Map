<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>9M2PJU Line-of-Sight Map</title>

  <!-- SEO Tags -->
  <meta name="description" content="Interactive line-of-sight calculator for Malaysian amateur radio (UHF/VHF). Estimate signal reach using terrain data." />
  <meta name="keywords" content="line of sight, vhf, uhf, ham radio, amateur radio, terrain, map, repeater coverage, malaysia, 9M2PJU" />
  <meta name="theme-color" content="#0d1117" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Bootstrap Dark Theme -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- jQuery & Highcharts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>

  <!-- Custom Styles -->
  <style>
    body {
      background-color: #0d1117;
      color: #e6edf3;
    }

    h1, h2, h3, h4, h5, h6 {
      color: #58a6ff;
    }

    .input-group-text,
    .form-control,
    .btn,
    .card {
      background-color: #161b22;
      border-color: #30363d;
      color: #e6edf3;
    }

    .btn-primary {
      background-color: #238636;
      border-color: #2ea043;
    }

    .btn-primary:hover {
      background-color: #2ea043;
    }

    a {
      color: #58a6ff;
    }

    #map {
      height: 500px;
      margin-top: 1rem;
      border: 1px solid #30363d;
    }

    .card {
      background-color: #161b22;
    }

    .border {
      border-color: #30363d !important;
    }

    .form-control:focus {
      background-color: #161b22;
      color: #e6edf3;
      border-color: #58a6ff;
      box-shadow: 0 0 0 0.25rem rgba(88, 166, 255, 0.25);
    }
  </style>

  <!-- Your JavaScript -->
  <script src="index.js"></script>
</head>

<body class="d-flex flex-column h-100">
  <main class="flex-shrink-0 container-fluid">
    <div class="container mt-4 mb-4">
      <h1 class="text-center">9M2PJU Line-of-Sight Map</h1>

      <p>
        This tool helps identify potential line-of-sight paths for UHF (70 cm) and VHF (2 m) amateur radio communications‚Äîbands where terrain and obstructions often affect communication more than atmospheric conditions.
      </p>
      <p>
        Start by entering an address or coordinates for both locations. You can fine-tune the positions by dragging the markers on the map. The tool uses terrain data to estimate the path.
      </p>
      <p class="mb-4">
        Note: Results are only estimates. Real-world obstructions such as buildings and trees may impact communication.
      </p>

      <!-- Instructions -->
      <div>
        <button class="btn btn-link text-white p-0" data-bs-toggle="collapse" data-bs-target="#instructions-repeaterbook" aria-expanded="false" aria-controls="instructions-repeaterbook">
          üìç How to Get Coordinates from RepeaterBook
        </button>
        <div class="collapse" id="instructions-repeaterbook">
          <div class="card card-body p-3 mt-2">
            <ul class="mb-0">
              <li>Open a repeater detail on RepeaterBook (e.g., <a href="https://www.repeaterbook.com/repeaters/details.php?state_id=41&ID=365" target="_blank">example link</a>)</li>
              <li>Press <kbd>F12</kbd> to open the browser console</li>
              <li>Type: <code>mymap.getCenter().lat + ',' + mymap.getCenter().lng</code></li>
              <li>Copy the returned <code>lat,lng</code> into the fields below (remove quote marks)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Form -->
    <form id="searchform" onsubmit="return false;" class="container pb-4">
      <div class="row g-4">
        <div class="col-12 col-md-6">
          <p class="fw-bold mb-2">üì° Transmitting Location</p>
          <div class="input-group mb-2">
            <span class="input-group-text">Lat,lng or address</span>
            <input type="text" name="xaddr" placeholder="address or lat,lng" class="form-control text-end" />
            <button type="button" class="btn btn-primary" name="xsearchgo">Find</button>
          </div>
          <div class="input-group">
            <span class="input-group-text">Mast height</span>
            <input type="number" name="xheight" value="0" min="0" max="500" class="form-control text-end" />
            <span class="input-group-text">feet</span>
          </div>
        </div>

        <div class="col-12 col-md-6">
          <p class="fw-bold mb-2">üì∂ Receiving Location</p>
          <div class="input-group mb-2">
            <span class="input-group-text">Lat,lng or address</span>
            <input type="text" name="raddr" placeholder="address or lat,lng" class="form-control text-end" />
            <button type="button" class="btn btn-primary" name="rsearchgo">Find</button>
          </div>
          <div class="input-group">
            <span class="input-group-text">Mast height</span>
            <input type="number" name="rheight" value="0" min="0" max="500" class="form-control text-end" />
            <span class="input-group-text">feet</span>
          </div>
        </div>
      </div>
    </form>

    <!-- Readouts -->
    <div id="readouts" class="container d-none pb-4">
      <div class="row g-4">
        <div class="col-md-6">
          <div class="border rounded p-3 h-100">
            <h5>üìè Distance & Bearing</h5>
            <p>
              Distance: <span data-readout="distance_mi"></span> miles / <span data-readout="distance_km"></span> km<br />
              Horizon: <span data-readout="horizon_mi"></span> miles / <span data-readout="horizon_km"></span> km
              <br />
              <span id="insufficienthorizon" class="text-danger d-none">
                ‚ùó Beyond horizon limit ‚Äî unlikely to succeed
              </span>
            </p>
            <p>
              Elevation Tx: <span data-readout="transmit_elevation_ft"></span> ft / <span data-readout="transmit_elevation_m"></span> m<br />
              Elevation Rx: <span data-readout="receive_elevation_ft"></span> ft / <span data-readout="receive_elevation_m"></span> m
            </p>
            <p>
              Bearing: <span data-readout="bearing_deg"></span>¬∞ / <span data-readout="bearing_txt"></span>
            </p>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded p-3 h-100">
            <h5>üåÑ Elevation Profile</h5>
            <div id="elevationprofile"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Map -->
    <div class="container">
      <div id="map" class="rounded shadow-sm"></div>
    </div>
  </main>
</body>
</html>
