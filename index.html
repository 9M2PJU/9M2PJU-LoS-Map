<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>9M2PJU Line-of-Sight Map</title>

  <meta name="description"
    content="Estimate and visualize line-of-sight communication paths for UHF (70 cm) and VHF (2 m) amateur radio using real terrain data.">
  <meta name="keywords"
    content="line of sight, communication, radio, elevation, path, VHF, UHF, line-of-sight calculator, vhf uhf map, ham radio tool, amateur radio, ham radio, Malaysia, repeater planning, elevation profile, terrain analysis, 9M2PJU, amateur radio communication">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="9M2PJU Line-of-Sight Map">
  <meta property="og:description"
    content="Estimate and visualize line-of-sight communication paths for UHF (70 cm) and VHF (2 m) amateur radio using real terrain data.">
  <meta property="og:url" content="https://los.hamradio.my">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#0f0c29">

  <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
  <link rel="apple-touch-icon" href="favicon.png">
  <link rel="manifest" href="manifest.json">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Highcharts for elevation profile -->
  <script src="https://code.highcharts.com/highcharts.js"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>

  <!-- Custom Styles -->
  <link rel="stylesheet" href="index.css?v=2.0">
  <script src="index.js?v=2.0"></script>
</head>

<body>
  <main class="container">
    <!-- Header Section -->
    <header class="text-center mb-4">
      <h1 class="fw-bold mb-3">üì° 9M2PJU Line-of-Sight Map</h1>
      <p>This tool helps identify potential line-of-sight paths for <strong>UHF (70 cm)</strong> and <strong>VHF (2
          m)</strong> amateur radio communications bands where terrain and obstructions often have a greater impact than
        atmospheric conditions.</p>
      <p>Enter an address or coordinates for both locations. Drag the map markers to refine your positions and see
        terrain profiles.</p>
      <p class="text-muted small">‚ö†Ô∏è Results are terrain-based estimates. Real-world obstacles like buildings or trees
        may affect accuracy.</p>
    </header>

    <!-- Instructions Accordion -->
    <div class="accordion mb-3" id="accordionHelp">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
            data-bs-target="#instructions" aria-expanded="false">
            üìç How to get coordinates from RepeaterBook
          </button>
        </h2>
        <div id="instructions" class="accordion-collapse collapse" data-bs-parent="#accordionHelp">
          <div class="accordion-body">
            <ol>
              <li>Go to a repeater page on RepeaterBook (e.g., <a
                  href="https://www.repeaterbook.com/repeaters/details.php?state_id=41&ID=365"
                  target="_blank">example</a>).</li>
              <li>Open Developer Console with <code>F12</code>, switch to the Console tab.</li>
              <li>Paste this code: <code>mymap.getCenter().lat + ',' + mymap.getCenter().lng</code></li>
              <li>If prompted, type <code>allow pasting</code> to proceed.</li>
              <li>Copy the output (e.g., <code>44.9491733350656,-122.9332083463669</code>) and paste it into the form
                below (without quote marks).</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Input Form -->
    <form id="searchform" onsubmit="return false;">
      <div class="row g-3">
        <!-- Transmitting Location Card -->
        <div class="col-md-6">
          <div class="card">
            <h5 class="fw-bold text-center mb-3">üì° Transmitting Location</h5>
            <div class="input-group mb-2">
              <span class="input-group-text">Lat,lng or address</span>
              <input type="text" name="xaddr" class="form-control text-end"
                placeholder="e.g., address or 1.2345,103.5678">
              <button type="button" class="btn btn-outline-primary" name="xsearchgo">Find</button>
            </div>
            <div class="input-group">
              <span class="input-group-text">Mast height</span>
              <input type="number" name="xheight" value="0" min="0" max="500" step="1" class="form-control text-end">
              <span class="input-group-text">ft</span>
            </div>
          </div>
        </div>

        <!-- Receiving Location Card -->
        <div class="col-md-6">
          <div class="card">
            <h5 class="fw-bold text-center mb-3">üìª Receiving Location</h5>
            <div class="input-group mb-2">
              <span class="input-group-text">Lat,lng or address</span>
              <input type="text" name="raddr" class="form-control text-end"
                placeholder="e.g., address or 1.2345,103.5678">
              <button type="button" class="btn btn-outline-primary" name="rsearchgo">Find</button>
            </div>
            <div class="input-group">
              <span class="input-group-text">Mast height</span>
              <input type="number" name="rheight" value="0" min="0" max="500" step="1" class="form-control text-end">
              <span class="input-group-text">ft</span>
            </div>
          </div>
        </div>
      </div>
    </form>

    <!-- Results Readouts -->
    <div class="d-none" id="readouts">
      <div class="row g-3 align-items-stretch justify-content-center">
        <!-- Distance & Bearing Card -->
        <div class="col-md-6">
          <div class="card same-height">
            <h5 class="fw-bold">Distance & Bearing</h5>
            <p>
              Distance: <span data-readout="distance_mi"></span> mi, <span data-readout="distance_km"></span> km<br>
              Horizon: <span data-readout="horizon_mi"></span> mi, <span data-readout="horizon_km"></span> km
              <span class="d-none fw-bold" id="insufficienthorizon">
                <br>‚ö†Ô∏è Distance exceeds horizon. Contact unlikely.
              </span>
            </p>
            <p>
              Elevation (Tx): <span data-readout="transmit_elevation_ft"></span> ft, <span
                data-readout="transmit_elevation_m"></span> m<br>
              Elevation (Rx): <span data-readout="receive_elevation_ft"></span> ft, <span
                data-readout="receive_elevation_m"></span> m
            </p>
            <p>Bearing: <span data-readout="bearing_deg"></span>&deg;, <span data-readout="bearing_txt"></span></p>
          </div>
        </div>

        <!-- Elevation Profile Card -->
        <div class="col-md-6">
          <div class="card same-height">
            <h5 class="fw-bold">Elevation Profile</h5>
            <div id="elevationprofile"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Map Container -->
    <div id="map"></div>
  </main>

  <!-- Footer -->
  <footer>
    <p>Redesign by <a href="https://hamradio.my" target="_blank" rel="noopener noreferrer">9M2PJU</a> üá≤üáæ</p>
  </footer>

  <!-- Highcharts Dark Theme Configuration -->
  <script>
    // Custom dark theme for Highcharts
    Highcharts.setOptions({
      chart: {
        backgroundColor: 'transparent',
        style: {
          fontFamily: 'Inter, sans-serif'
        }
      },
      title: {
        style: {
          color: '#ffffff'
        }
      },
      legend: {
        itemStyle: {
          color: '#ffffff'
        }
      },
      xAxis: {
        labels: {
          style: {
            color: 'rgba(255, 255, 255, 0.7)'
          }
        },
        lineColor: 'rgba(255, 255, 255, 0.1)',
        tickColor: 'rgba(255, 255, 255, 0.1)'
      },
      yAxis: {
        labels: {
          style: {
            color: 'rgba(255, 255, 255, 0.7)'
          }
        },
        gridLineColor: 'rgba(255, 255, 255, 0.05)',
        lineColor: 'rgba(255, 255, 255, 0.1)',
        tickColor: 'rgba(255, 255, 255, 0.1)'
      },
      tooltip: {
        backgroundColor: 'rgba(15, 12, 41, 0.95)',
        borderColor: 'rgba(0, 212, 255, 0.3)',
        style: {
          color: '#ffffff'
        }
      },
      plotOptions: {
        series: {
          animation: {
            duration: 800
          }
        },
        area: {
          fillColor: {
            linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
            stops: [
              [0, 'rgba(0, 212, 255, 0.4)'],
              [1, 'rgba(123, 44, 191, 0.1)']
            ]
          },
          lineColor: '#00d4ff',
          lineWidth: 2,
          marker: {
            enabled: false,
            states: {
              hover: {
                enabled: true,
                fillColor: '#00d4ff',
                lineColor: '#ffffff',
                lineWidth: 2,
                radius: 5
              }
            }
          }
        }
      },
      credits: {
        enabled: false
      }
    });

    // Initialize elevation profile chart
    Highcharts.chart('elevationprofile', {
      chart: {
        type: 'area',
        height: null,
        zoomType: 'x',
        panning: true,
        panKey: 'shift'
      },
      title: {
        text: null
      },
      exporting: {
        enabled: false
      },
      xAxis: {
        title: {
          text: 'Distance (km)',
          style: {
            fontSize: '0.8rem'
          }
        },
        labels: {
          style: {
            fontSize: '0.75rem'
          }
        }
      },
      yAxis: {
        title: {
          text: 'Elevation (m)',
          style: {
            fontSize: '0.8rem'
          }
        },
        labels: {
          style: {
            fontSize: '0.75rem'
          }
        }
      },
      tooltip: {
        pointFormat: '<span style="color:{series.color}">\u25CF</span> {series.name}: <b>{point.y:.0f} m</b> at <b>{point.x:.2f} km</b><br/>'
      },
      series: [{
        name: 'Elevation',
        data: []
      }]
    });
  </script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('Service Worker registered:', reg.scope))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }
  </script>
</body>

</html>